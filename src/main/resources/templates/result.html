<!DOCTYPE html>
<html lang="en">
<head>
    <div th:replace="index :: fragment-header"></div>
</head>
<body>

<div style="text-align: center">
    <h1>
        <p>Search Match</p>
    </h1>
    <form th:action="@{/search}" method="get" autocomplete="on">
        <input type="text" name="summonerName" style="width: 400px; height: 20px" placeholder="닉네임" required>
        <button type="submit">검색</button>
    </form>
</div>

<br><br>

<div align="center">
    <th:block th:if="${summoner != null}">
        <table style="text-align: center">
            <tr>
                <td>
                    <img th:src="${summoner.profileIcon}" width="150" style="border-radius: 30px">
                </td>
                <td>
                    <h2>
                        <p>
                            <span th:text="${summoner.name}"></span>
                        </p>
                        <p>
                            레벨 : <span th:text="${summoner.summonerLevel}"></span>
                        </p>
                    </h2>
                </td>
            </tr>
            <tr>
                <th:block th:if="${leagueEntry.tier != null}">
                    <td>
                        <p><img th:src="${leagueEntry.tierUrl}" width="150" style="border-radius: 30px"></p>
                    </td>
                    <td>
                        <h2>
                            <p>
                                <span th:text="${leagueEntry.tier}"></span>
                                <span th:text="${leagueEntry.rank}"></span>
                                <span th:text="${leagueEntry.leaguePoints} + 포인트"></span>
                            </p>
                            <p>
                                <span th:text="${leagueEntry.wins}"></span>승
                                <span th:text="${leagueEntry.losses}"></span>패
                            </p>
                        </h2>
                    </td>
                </th:block>
            </tr>
        </table>

        <th:blcok th:if="${leagueEntry.tier == null}">
            <h2>Unranked</h2>
        </th:blcok>

        <table align="center">
            <tbody id="match-table"></tbody>
        </table>

        <div id="loading"><img src="https://blog.kakaocdn.net/dn/bVlxDK/btq6lZaZ9u5/tt3SQWLkf692DbCsQMJS0k/img.gif"></div>

        <br>

        <button type="button" id="resultButton" th:onclick="callPastMatch([[${summoner.name}]])">더 보기</button>
    </th:block>

    <th:block th:if="${summoner == null}">
        <h2>
            잘못된 소환사 이름입니다. 다시 입력하세요.
        </h2>
    </th:block>

</div>

<script th:inline="javascript">
    let start = 0;

    /*<![CDATA[*/
    $(function (){
        $('#loading').hide();

        if([[${summoner}]] != null) {
            $.ajax({
                beforeSend: function () {
                    $('#loading').show();
                    $('#resultButton').hide();
                },
                url: '/' + [[${summoner?.name}]] + '/' + start,
                type: 'GET',
                complete: function () {
                    $('#loading').hide();
                    $('#resultButton').show();
                },
            }).done(function (result) {
                $('#match-table').append(result);
                start = start + 5;
            });
        }
    })
    /*]]*/

    function callPastMatch(summonerName) {
        $.ajax({
            beforeSend: function () {
                $('#loading').show();
                $('#resultButton').hide();
            },
            url: '/' + summonerName + '/' + start,
            type: 'GET',
            complete: function () {
                $('#loading').hide();
                $('#resultButton').show();
            },
        }).done(function (result) {
            $('#match-table').append(result);
            start = start + 5;
        });
    }
</script>

</body>
</html>