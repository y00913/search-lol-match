<!DOCTYPE html>
<html lang="en">
<head>
    <div th:replace="index :: fragment-header"></div>
</head>
<body>

<div style="text-align: center">
    <h1>
        <p>Search Match</p>
    </h1>
    <form th:action="@{/search}" method="get" autocomplete="on">
        <input type="text" name="summonerName" style="width: 400px; height: 20px" placeholder="닉네임" required>
        <button type="submit">검색</button>
    </form>
</div>

<br><br>

<div align="center">
    <th:block th:if="${summoner != null}">
        <table style="text-align: center">
            <tr>
                <table>
                    <tr align="center" style="padding: 1em">
                        <td>
                            <img th:src="${summoner.profileIcon}" width="100" style="border-radius: 30px">
                        </td>
                        <td>
                            <h2>
                                <p>
                                    <span th:text="${summoner.name}"></span>
                                </p>
                                <p>
                                    레벨 : <span th:text="${summoner.summonerLevel}"></span>
                                </p>
                            </h2>
                        </td>

                        <td style="padding-left: 150px">
                            <th:block th:if="${leagueEntry.Ranked_Solo != null}">
                                <p><img th:src="${leagueEntry.Ranked_Solo.tierUrl}" width="100"
                                        style="border-radius: 30px"></p>
                            </th:block>
                        </td>

                        <td style="border-collapse: collapse; border-spacing: 1px 1px">
                            <div style="margin-bottom: 0">
                                <strong><span>솔로 랭크</span></strong>
                            </div>

                            <th:block th:if="${leagueEntry.Ranked_Solo != null}">
                                <strong>
                                    <div style="margin-bottom: 0; font-size: 1.5em">
                                        <span th:text="${leagueEntry.Ranked_Solo.tier}"></span>
                                        <span th:text="${leagueEntry.Ranked_Solo.rank}"></span>
                                    </div>
                                </strong>
                                <div style="margin-bottom: 0">
                                    <strong>
                                        <span th:text="${leagueEntry.Ranked_Solo.leaguePoints} + lp"></span>
                                    </strong>
                                </div>
                                <strong>
                                    <div style="margin-bottom: 0">
                                        <span th:text="${leagueEntry.Ranked_Solo.wins}"></span>승
                                        <span th:text="${leagueEntry.Ranked_Solo.losses}"></span>패
                                    </div>
                                </strong>

                            </th:block>
                            <th:blcok th:if="${leagueEntry.Ranked_Solo == null}">
                                <h2>Unranked</h2>
                            </th:blcok>
                        </td>

                        <td style="padding-left: 50px">
                            <th:block th:if="${leagueEntry.Ranked_Flex != null}">
                                <p><img th:src="${leagueEntry.Ranked_Flex.tierUrl}" width="100"
                                        style="border-radius: 30px"></p>
                            </th:block>
                        </td>

                        <td style="border-collapse: collapse; border-spacing: 1px 1px">
                            <div style="margin-bottom: 0">
                                <strong><span>자유 랭크</span></strong>
                            </div>

                            <th:block th:if="${leagueEntry.Ranked_Flex != null}">
                                <strong>
                                    <div style="margin-bottom: 0; font-size: 1.5em">
                                        <span th:text="${leagueEntry.Ranked_Flex.tier}"></span>
                                        <span th:text="${leagueEntry.Ranked_Flex.rank}"></span>
                                    </div>
                                </strong>
                                <div style="margin-bottom: 0">
                                    <strong>
                                        <span th:text="${leagueEntry.Ranked_Flex.leaguePoints} + lp"></span>
                                    </strong>
                                </div>
                                <strong>
                                    <div style="margin-bottom: 0">
                                        <span th:text="${leagueEntry.Ranked_Flex.wins}"></span>승
                                        <span th:text="${leagueEntry.Ranked_Flex.losses}"></span>패
                                    </div>
                                </strong>

                            </th:block>
                            <th:blcok th:if="${leagueEntry.Ranked_Flex == null}">
                                <h2>Unranked</h2>
                            </th:blcok>
                        </td>
                    </tr>
                </table>

            </tr>

        </table>

        <table align="center">
            <tbody id="match-table"></tbody>
        </table>

        <div id="loading"><img src="https://blog.kakaocdn.net/dn/bVlxDK/btq6lZaZ9u5/tt3SQWLkf692DbCsQMJS0k/img.gif">
        </div>

        <br>

        <button type="button" id="resultButton" th:onclick="callPastMatch([[${summoner.name}]])">더 보기</button>
    </th:block>

    <th:block th:if="${summoner == null}">
        <h2>
            잘못된 소환사 이름입니다. 다시 입력하세요.
        </h2>
    </th:block>

</div>

<script th:inline="javascript">
    let start = 0;

    /*<![CDATA[*/
    $(function () {
        $('#loading').hide();

        if ([[${summoner}]] != null) {
            $.ajax({
                beforeSend: function () {
                    $('#loading').show();
                    $('#resultButton').hide();
                },
                url: '/' + [[${summoner?.name}]] + '/' + start,
                type: 'GET',
                complete: function () {
                    $('#loading').hide();
                    $('#resultButton').show();
                },
            }).done(function (result) {
                $('#match-table').append(result);
                start = start + 5;
            });
        }
    })

    /*]]*/

    function callPastMatch(summonerName) {
        $.ajax({
            beforeSend: function () {
                $('#loading').show();
                $('#resultButton').hide();
            },
            url: '/' + summonerName + '/' + start,
            type: 'GET',
            complete: function () {
                $('#loading').hide();
                $('#resultButton').show();
            },
        }).done(function (result) {
            $('#match-table').append(result);
            start = start + 5;
        });
    }
</script>

</body>
</html>